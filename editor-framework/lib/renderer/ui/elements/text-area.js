"use strict";const e=require("./utils"),t=require("../../../share/platform"),i=require("../utils/resource-mgr"),s=require("../utils/dom-utils"),a=require("../utils/focus-mgr"),u=require("../behaviors/focusable"),l=require("../behaviors/disable"),n=require("../behaviors/readonly"),h=require("../behaviors/input-state");let r="âŒ˜ + enter";t.isWin32&&(r="ctrl + enter"),module.exports=e.registerElement("ui-text-area",{get value(){return this._value},set value(e){null!==e&&void 0!==e||(e=""),e+="",this._value=e,this._multiValues||(null!==this._maxLength?this.$input.value=e.substr(0,this._maxLength):this.$input.value=e)},get values(){return this._values},set values(e){this._values=e,this.multiValues&&(this.$input.value="-")},get placeholder(){return this.$input.placeholder},set placeholder(e){this.$input.placeholder=e},get maxLength(){return this._maxLength},set maxLength(e){null!==e&&(e-=0),isNaN(e)&&(e=null),this._maxLength=e,e&&(this.$input.value=this._value.substr(0,this._maxLength))},get multiValues(){return this._multiValues},set multiValues(e){(e=!(null==e||!1===e))!==this._multiValues&&(this._multiValues=e,e?(this.$input.value="-",this.setAttribute("multi-values","")):(this.$input.value=this._value,this.removeAttribute("multi-values")))},get observedAttributes(){return["placeholder","max-length","multi-values"]},attributeChangedCallback(e,t,i){if(t!==i)switch(e){case"multi-values":case"placeholder":case"max-length":this[e.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()})]=i}},behaviors:[u,l,n,h],template:`\n    <div class="back">\n      <span>${r}</span>\n    </div>\n    <textarea></textarea>\n  `,style:i.getResource("theme://elements/text-area.css"),$:{input:"textarea",span:"span"},factoryImpl(e){e&&(this.value=e)},ready(){this._value="",this._values=[""],this.value=this.getAttribute("value"),this.placeholder=this.getAttribute("placeholder")||"",this.maxLength=this.getAttribute("max-length"),this.multiValues=this.getAttribute("multi-values"),this._initFocusable(this,this.$input),this._initDisable(!1),this._initReadonly(!1),this._initInputState(this.$input),this.$input.readOnly=this.readonly,this._initEvents()},clear(){this._value="",this._values=[""],this.$input.value="",this.confirm()},confirm(){this._onInputConfirm(this.$input)},cancel(){this._onInputCancel(this.$input)},_initEvents(){this.addEventListener("mousedown",this._mouseDownHandler),this.addEventListener("keydown",this._keyDownHandler),this.addEventListener("focus-changed",this._focusChangedHandler),this.$input.addEventListener("focus",()=>{this.$span.style.display="inline-block"}),this.$input.addEventListener("blur",()=>{this.$span.style.display="none"})},_onInputConfirm(e,t){this.readonly||this._changed&&(this._changed=!1,e._initValue=e.value,this._value=e.value,this.multiValues=!1,s.fire(this,"confirm",{bubbles:!0,detail:{value:e.value,confirmByEnter:t}})),t&&this.focus()},_onInputCancel(e,t){this.readonly||this._changed&&(this._changed=!1,e._initValue!==e.value&&(this._value=e.value=e._initValue,s.fire(this,"change",{bubbles:!0,detail:{value:e.value}})),s.fire(this,"cancel",{bubbles:!0,detail:{value:e.value,cancelByEsc:t}})),t&&(e.blur(),this.focus())},_onInputChange(e){this._changed=!0,this._maxLength&&e.value.length>this._maxLength&&(e.value=e.value.substr(0,this._maxLength)),this._value=e.value,s.fire(this,"change",{bubbles:!0,detail:{value:e.value}})},_mouseDownHandler(e){e.stopPropagation(),a._setFocusElement(this)},_keyDownHandler(e){this.disabled||13!==e.keyCode&&32!==e.keyCode||(s.acceptEvent(e),this.$input._initValue=this.$input.value,this.$input.focus(),this.$input.select())},_focusChangedHandler(){this.focused?this.$input._initValue=this.$input.value:this._unselect(this.$input)}});