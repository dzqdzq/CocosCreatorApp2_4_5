"use strict";const t=require("readable-stream").Duplex,e=require("inherits"),i=require("./BufferList");function n(e){if(!(this instanceof n))return new n(e);if("function"==typeof e){this._callback=e;const t=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)}),e=null}i._init.call(this,e),t.call(this)}e(n,t),Object.assign(n.prototype,i.prototype),n.prototype._new=function(t){return new n(t)},n.prototype._write=function(t,e,i){this._appendBuffer(t),"function"==typeof i&&i()},n.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},n.prototype.end=function(e){t.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},n.prototype._destroy=function(t,e){this._bufs.length=0,this.length=0,e(t)},n.prototype._isBufferList=function(t){return t instanceof n||t instanceof i||n.isBufferList(t)},n.isBufferList=i.isBufferList,module.exports=n,module.exports.BufferListStream=n,module.exports.BufferList=i;