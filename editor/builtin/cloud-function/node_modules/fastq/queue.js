"use strict";var n=require("reusify");function e(){}function r(){this.value=null,this.callback=e,this.next=null,this.release=e,this.context=null,this.errorHandler=null;var n=this;this.worked=function(r,u){var l=n.callback,t=n.errorHandler,a=n.value;n.value=null,n.callback=e,n.errorHandler&&t(r,a),l.call(n.context,r,u),n.release(n)}}module.exports=function(u,l,t){if("function"==typeof u&&(t=l,l=u,u=null),t<1)throw new Error("fastqueue concurrency must be greater than 1");var a=n(r),c=null,o=null,i=0,s=null,d={push:function(n,r){var t=a.get();t.context=u,t.release=f,t.value=n,t.callback=r||e,t.errorHandler=s,i===d.concurrency||d.paused?o?(o.next=t,o=t):(c=t,o=t,d.saturated()):(i++,l.call(u,t.value,t.worked))},drain:e,saturated:e,pause:function(){d.paused=!0},paused:!1,concurrency:t,running:function(){return i},resume:function(){if(d.paused){d.paused=!1;for(var n=0;n<d.concurrency;n++)i++,f()}},idle:function(){return 0===i&&0===d.length()},length:function(){for(var n=c,e=0;n;)n=n.next,e++;return e},getQueue:function(){for(var n=c,e=[];n;)e.push(n.value),n=n.next;return e},unshift:function(n,r){var t=a.get();t.context=u,t.release=f,t.value=n,t.callback=r||e,i===d.concurrency||d.paused?c?(t.next=c,c=t):(c=t,o=t,d.saturated()):(i++,l.call(u,t.value,t.worked))},empty:e,kill:function(){c=null,o=null,d.drain=e},killAndDrain:function(){c=null,o=null,d.drain(),d.drain=e},error:function(n){s=n}};return d;function f(n){n&&a.release(n);var e=c;e?d.paused?i--:(o===c&&(o=null),c=e.next,e.next=null,l.call(u,e.value,e.worked),null===o&&d.empty()):0==--i&&d.drain()}};