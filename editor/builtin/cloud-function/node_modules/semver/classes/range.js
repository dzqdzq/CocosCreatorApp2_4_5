class e{constructor(t,i){if(i=r(i),t instanceof e)return t.loose===!!i.loose&&t.includePrerelease===!!i.includePrerelease?t:new e(t.raw,i);if(t instanceof s)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=i,this.loose=!!i.loose,this.includePrerelease=!!i.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!c(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&h(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const r=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=t.get(r);if(n)return n;const h=this.options.loose,u=h?o[$.HYPHENRANGELOOSE]:o[$.HYPHENRANGE];e=e.replace(u,v(this.options.includePrerelease)),i("hyphen replace",e),e=e.replace(o[$.COMPARATORTRIM],a),i("comparator trim",e,o[$.COMPARATORTRIM]),e=(e=(e=e.replace(o[$.TILDETRIM],l)).replace(o[$.CARETTRIM],p)).split(/\s+/).join(" ");const f=h?o[$.COMPARATORLOOSE]:o[$.COMPARATOR],R=e.split(" ").map(e=>m(e,this.options)).join(" ").split(/\s+/).map(e=>P(e,this.options)).filter(this.options.loose?e=>!!e.match(f):()=>!0).map(e=>new s(e,this.options)),g=(R.length,new Map);for(const e of R){if(c(e))return[e];g.set(e.value,e)}g.size>1&&g.has("")&&g.delete("");const T=[...g.values()];return t.set(r,T),T}intersects(t,r){if(!(t instanceof e))throw new TypeError("a Range is required");return this.set.some(e=>u(e,r)&&t.set.some(t=>u(t,r)&&e.every(e=>t.every(t=>e.intersects(t,r)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new n(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(w(this.set[t],e,this.options))return!0;return!1}}module.exports=e;const t=new(require("lru-cache"))({max:1e3}),r=require("../internal/parse-options"),s=require("./comparator"),i=require("../internal/debug"),n=require("./semver"),{re:o,t:$,comparatorTrimReplace:a,tildeTrimReplace:l,caretTrimReplace:p}=require("../internal/re"),c=e=>"<0.0.0-0"===e.value,h=e=>""===e.value,u=(e,t)=>{let r=!0;const s=e.slice();let i=s.pop();for(;r&&s.length;)r=s.every(e=>i.intersects(e,t)),i=s.pop();return r},m=(e,t)=>(i("comp",e,t),e=T(e,t),i("caret",e),e=R(e,t),i("tildes",e),e=d(e,t),i("xrange",e),e=A(e,t),i("stars",e),e),f=e=>!e||"x"===e.toLowerCase()||"*"===e,R=(e,t)=>e.trim().split(/\s+/).map(e=>g(e,t)).join(" "),g=(e,t)=>{const r=t.loose?o[$.TILDELOOSE]:o[$.TILDE];return e.replace(r,(t,r,s,n,o)=>{let $;return i("tilde",e,t,r,s,n,o),f(r)?$="":f(s)?$=`>=${r}.0.0 <${+r+1}.0.0-0`:f(n)?$=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:o?(i("replaceTilde pr",o),$=`>=${r}.${s}.${n}-${o} <${r}.${+s+1}.0-0`):$=`>=${r}.${s}.${n} <${r}.${+s+1}.0-0`,i("tilde return",$),$})},T=(e,t)=>e.trim().split(/\s+/).map(e=>E(e,t)).join(" "),E=(e,t)=>{i("caret",e,t);const r=t.loose?o[$.CARETLOOSE]:o[$.CARET],s=t.includePrerelease?"-0":"";return e.replace(r,(t,r,n,o,$)=>{let a;return i("caret",e,t,r,n,o,$),f(r)?a="":f(n)?a=`>=${r}.0.0${s} <${+r+1}.0.0-0`:f(o)?a="0"===r?`>=${r}.${n}.0${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${s} <${+r+1}.0.0-0`:$?(i("replaceCaret pr",$),a="0"===r?"0"===n?`>=${r}.${n}.${o}-${$} <${r}.${n}.${+o+1}-0`:`>=${r}.${n}.${o}-${$} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${o}-${$} <${+r+1}.0.0-0`):(i("no pr"),a="0"===r?"0"===n?`>=${r}.${n}.${o}${s} <${r}.${n}.${+o+1}-0`:`>=${r}.${n}.${o}${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${o} <${+r+1}.0.0-0`),i("caret return",a),a})},d=(e,t)=>(i("replaceXRanges",e,t),e.split(/\s+/).map(e=>O(e,t)).join(" ")),O=(e,t)=>{e=e.trim();const r=t.loose?o[$.XRANGELOOSE]:o[$.XRANGE];return e.replace(r,(r,s,n,o,$,a)=>{i("xRange",e,r,s,n,o,$,a);const l=f(n),p=l||f(o),c=p||f($),h=c;return"="===s&&h&&(s=""),a=t.includePrerelease?"-0":"",l?r=">"===s||"<"===s?"<0.0.0-0":"*":s&&h?(p&&(o=0),$=0,">"===s?(s=">=",p?(n=+n+1,o=0,$=0):(o=+o+1,$=0)):"<="===s&&(s="<",p?n=+n+1:o=+o+1),"<"===s&&(a="-0"),r=`${s+n}.${o}.${$}${a}`):p?r=`>=${n}.0.0${a} <${+n+1}.0.0-0`:c&&(r=`>=${n}.${o}.0${a} <${n}.${+o+1}.0-0`),i("xRange return",r),r})},A=(e,t)=>(i("replaceStars",e,t),e.trim().replace(o[$.STAR],"")),P=(e,t)=>(i("replaceGTE0",e,t),e.trim().replace(o[t.includePrerelease?$.GTE0PRE:$.GTE0],"")),v=e=>(t,r,s,i,n,o,$,a,l,p,c,h,u)=>`${r=f(s)?"":f(i)?`>=${s}.0.0${e?"-0":""}`:f(n)?`>=${s}.${i}.0${e?"-0":""}`:o?`>=${r}`:`>=${r}${e?"-0":""}`} ${a=f(l)?"":f(p)?`<${+l+1}.0.0-0`:f(c)?`<${l}.${+p+1}.0-0`:h?`<=${l}.${p}.${c}-${h}`:e?`<${l}.${p}.${+c+1}-0`:`<=${a}`}`.trim(),w=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(i(e[r].semver),e[r].semver!==s.ANY&&e[r].semver.prerelease.length>0){const s=e[r].semver;if(s.major===t.major&&s.minor===t.minor&&s.patch===t.patch)return!0}return!1}return!0};