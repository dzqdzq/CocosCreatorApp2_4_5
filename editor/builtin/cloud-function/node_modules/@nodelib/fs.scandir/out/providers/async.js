"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.readdir=exports.readdirWithFileTypes=exports.read=void 0;const t=require("@nodelib/fs.stat"),e=require("run-parallel"),r=require("../constants"),n=require("../utils"),i=require("./common");function s(t,r,s){r.fs.readdir(t,{withFileTypes:!0},(a,l)=>{if(null!==a)return o(s,a);const p=l.map(e=>({dirent:e,name:e.name,path:i.joinPathSegments(t,e.name,r.pathSegmentSeparator)}));if(!r.followSymbolicLinks)return u(s,p);const c=p.map(t=>(function(t,e){return r=>{if(!t.dirent.isSymbolicLink())return r(null,t);e.fs.stat(t.path,(i,s)=>null!==i?e.throwErrorOnBrokenSymbolicLink?r(i):r(null,t):(t.dirent=n.fs.createDirentFromStats(t.name,s),r(null,t)))}})(t,r));e(c,(t,e)=>{if(null!==t)return o(s,t);u(s,e)})})}function a(r,s,a){s.fs.readdir(r,(l,p)=>{if(null!==l)return o(a,l);const c=p.map(t=>i.joinPathSegments(r,t,s.pathSegmentSeparator)),d=c.map(e=>r=>t.stat(e,s.fsStatSettings,r));e(d,(t,e)=>{if(null!==t)return o(a,t);const r=[];p.forEach((t,i)=>{const a=e[i],o={name:t,path:c[i],dirent:n.fs.createDirentFromStats(t,a)};s.stats&&(o.stats=a),r.push(o)}),u(a,r)})})}function o(t,e){t(e)}function u(t,e){t(null,e)}exports.read=function(t,e,n){return!e.stats&&r.IS_SUPPORT_READDIR_WITH_FILE_TYPES?s(t,e,n):a(t,e,n)},exports.readdirWithFileTypes=s,exports.readdir=a;