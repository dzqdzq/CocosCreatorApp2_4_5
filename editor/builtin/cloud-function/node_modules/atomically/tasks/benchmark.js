const a=require("fs"),e=require("os"),t=require("path"),i=require("promise-resolve-timeout"),o=require("write-file-atomic"),{writeFile:c,writeFileSync:s}=require("../dist"),l=e.tmpdir(),n=a=>t.join(l,`atomically-temp-${a}.txt`),y=async(a,e,t,o)=>{console.time(a);for(let a=0;a<250;a++)await e(n(a),t,o);console.timeEnd(a),await i(1e3)},r=async(a,e,t,o)=>{console.time(a);for(let a=0;a<250;a++)e(n(a),t,o);console.timeEnd(a),await i(1e3)},f=async(a,e)=>{await(async(a,e)=>{await y(`${a} -> async -> write-file-atomic`,o,e),await y(`${a} -> async -> write-file-atomic (fastest)`,o,e,{fsync:!1}),await y(`${a} -> async -> atomically`,c,e),await y(`${a} -> async -> atomically (faster)`,c,e,{mode:!1,chown:!1,fsyncWait:!1}),await y(`${a} -> async -> atomically (fastest)`,c,e,{mode:!1,chown:!1,fsync:!1})})(a,e),console.log("-------------------"),((a,e)=>{r(`${a} -> sync -> write-file-atomic`,o.sync,e),r(`${a} -> sync -> write-file-atomic (fastest)`,o.sync,e,{fsync:!1}),r(`${a} -> sync -> atomically`,s,e),r(`${a} -> sync -> atomically (faster)`,s,e,{mode:!1,chown:!1,fsyncWait:!1}),r(`${a} -> sync -> atomically (fastest)`,s,e,{mode:!1,chown:!1,fsync:!1})})(a,e)};(async()=>{void r("dummy",a.writeFileSync,""),console.log("==================="),await f("100kb",Buffer.allocUnsafe(102400)),console.log("==================="),await f("10kb",Buffer.allocUnsafe(10240)),console.log("==================="),await f("1kb",Buffer.allocUnsafe(1024)),console.log("===================")})();