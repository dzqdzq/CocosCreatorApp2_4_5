"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("path"),t=require("../consts"),r=require("./fs"),n={store:{},create:e=>{const t=`000000${Math.floor(16777215*Math.random()).toString(16)}`.slice(-6);return`${e}${`.tmp-${Date.now().toString().slice(-10)}${t}`}`},get:(e,t,r=!0)=>{const s=n.truncate(t(e));if(s in n.store)return n.get(e,t,r);n.store[s]=r;return[s,()=>delete n.store[s]]},purge:e=>{n.store[e]&&(delete n.store[e],r.default.unlinkAttempt(e))},purgeSync:e=>{n.store[e]&&(delete n.store[e],r.default.unlinkSyncAttempt(e))},purgeSyncAll:()=>{for(const e in n.store)n.purgeSync(e)},truncate:r=>{const n=e.basename(r);if(n.length<=t.LIMIT_BASENAME_LENGTH)return r;const s=/^(\.?)(.*?)((?:\.[^.]+)?(?:\.tmp-\d{10}[a-f0-9]{6})?)$/.exec(n);if(!s)return r;const o=n.length-t.LIMIT_BASENAME_LENGTH;return`${r.slice(0,-n.length)}${s[1]}${s[2].slice(0,-o)}${s[3]}`}};process.on("exit",n.purgeSyncAll),exports.default=n;