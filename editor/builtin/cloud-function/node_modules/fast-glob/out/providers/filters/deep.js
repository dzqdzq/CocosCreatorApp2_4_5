"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../../utils"),e=require("../matchers/partial");exports.default=class{constructor(t,e){this._settings=t,this._micromatchOptions=e}getFilter(t,e,i){const s=this._getMatcher(e),r=this._getNegativePatternsRe(i);return e=>this._filter(t,e,s,r)}_getMatcher(t){return new e.default(t,this._settings,this._micromatchOptions)}_getNegativePatternsRe(e){const i=e.filter(t.pattern.isAffectDepthOfReadingPattern);return t.pattern.convertPatternsToRe(i,this._micromatchOptions)}_filter(e,i,s,r){if(this._isSkippedByDeep(e,i.path))return!1;if(this._isSkippedSymbolicLink(i))return!1;const n=t.path.removeLeadingDotSegment(i.path);return!this._isSkippedByPositivePatterns(n,s)&&this._isSkippedByNegativePatterns(n,r)}_isSkippedByDeep(t,e){return this._settings.deep!==1/0&&this._getEntryLevel(t,e)>=this._settings.deep}_getEntryLevel(t,e){const i=e.split("/").length;return""===t?i:i-t.split("/").length}_isSkippedSymbolicLink(t){return!this._settings.followSymbolicLinks&&t.dirent.isSymbolicLink()}_isSkippedByPositivePatterns(t,e){return!this._settings.baseNameMatch&&!e.match(t)}_isSkippedByNegativePatterns(e,i){return!t.pattern.matchAny(e,i)}};