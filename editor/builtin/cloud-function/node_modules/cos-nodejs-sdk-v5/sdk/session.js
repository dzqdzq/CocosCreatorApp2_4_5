var e,n,t=require("conf"),i=require("./util"),o=function(){try{localStorage.setItem("cos_sdk_upload_cache",JSON.stringify(e))}catch(e){}},l=function(){if(!e){(function(){var n,i={configName:"cos-nodejs-sdk-v5-storage"};this.options.ConfCwd&&(i.cwd=this.options.ConfCwd);try{n=new t(i).get("cos_sdk_upload_cache")}catch(e){}n&&n instanceof Array||(n=[]),e=n}).call(this);for(var n=!1,i=Math.round(Date.now()/1e3),l=e.length-1;l>=0;l--){var s=e[l][2];(!s||s+2592e3<i)&&(e.splice(l,1),n=!0)}n&&o()}},s=function(){n||(n=setTimeout(function(){o(),n=null},400))},c={using:{},setUsing:function(e){c.using[e]=!0},removeUsing:function(e){delete c.using[e]},getFileId:function(e,n,t,o){return e&&e.FilePath&&e.size&&e.ctime&&e.mtime&&n?i.md5([e.FilePath].join("::"))+"-"+i.md5([e.size,e.ctime,e.mtime,n,t,o].join("::")):null},getUploadIdList:function(n){if(!n)return null;l.call(this);for(var t=[],i=0;i<e.length;i++)e[i][0]===n&&t.push(e[i][1]);return t.length?t:null},saveUploadId:function(n,t,i){if(l.call(this),n){for(var o=n.substr(0,n.indexOf("-")+1),c=e.length-1;c>=0;c--){var r=e[c];r[0]===n&&r[1]===t?e.splice(c,1):n!==r[0]&&0===r[0].indexOf(o)&&e.splice(c,1)}e.unshift([n,t,Math.round(Date.now()/1e3)]),e.length>i&&e.splice(i),s()}},removeUploadId:function(n){l.call(this),delete c.using[n];for(var t=e.length-1;t>=0;t--)e[t][1]===n&&e.splice(t,1);s()}};module.exports=c;