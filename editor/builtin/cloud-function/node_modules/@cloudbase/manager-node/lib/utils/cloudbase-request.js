"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cloudBaseRequest=void 0;const e=require("./auth"),t=require("./http-request"),n=["ap-shanghai","ap-guangzhou"];exports.cloudBaseRequest=async function(s){const{config:c,params:a={},method:o="POST",headers:i={}}=s,{region:r,envId:p}=c,d="SCF"===process.env.TENCENTCLOUD_RUNENV,u=d?"http":"https",l=!!process.env.KUBERNETES_SERVICE_HOST,m=process.env.TCB_REGION||r||process.env.TENCENTCLOUD_REGION||"";let b="",h="";m?n.includes(m)?(b=`${m}.tcb-api.tencentcloudapi.com`,h=`internal.${m}.tcb-api.tencentcloudapi.com`):(console.warn("当前仅支持上海，广州地域，其他地域默认解析到固定域名(上海地域)"),b="tcb-api.tencentcloudapi.com",h="internal.tcb-api.tencentcloudapi.com"):(b="tcb-api.tencentcloudapi.com",h="internal.tcb-api.tencentcloudapi.com");const O=`${u}://${r&&r!==process.env.TENCENTCLOUD_REGION||!d&&!l?b:h}/admin`,g=Object.assign(Object.assign({},a),{envName:c.envId,timestamp:Date.now()}),E=Object.assign(Object.assign({},i),{"content-type":"application/json","user-agent":"cloudbase-manager-node/0.1.0","x-tcb-source":"cloudbase-manager-node, not-scf"}),{secretId:N,secretKey:T,token:v,proxy:C}=c,_={secretId:N,secretKey:T,method:o,pathname:"/admin",params:g,headers:E},I=e.getAuth(_),R=Object.assign(Object.assign({},g),{sessionToken:v,authorization:I});return await t.fetch(O,{method:o,body:JSON.stringify(R),headers:E},process.env.TCB_ADMIN_PROXY||C)};