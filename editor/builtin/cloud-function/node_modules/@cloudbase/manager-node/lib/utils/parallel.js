"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AsyncTaskParallelController=void 0;exports.AsyncTaskParallelController=class{constructor(s,t=20){this.tasks=[],this.maxParallel=Number(s)||20,this.checkInterval=t}loadTasks(s){this.tasks.push(...s),this.totalTasks=this.tasks.length}push(s){this.tasks.push(s),this.totalTasks=this.tasks.length}async run(){const s=[],t=[],a=[];let e=0;return new Promise(l=>{const r=setInterval(()=>{const h=a.filter(s=>s).length;0===e&&h===this.totalTasks&&(clearInterval(r),l(s)),e>=this.maxParallel||this.tasks.forEach((l,r)=>{!t[r]&&e<this.maxParallel&&(e++,t[r]=1,l().then(t=>{s[r]=t}).catch(t=>{s[r]=t}).then(()=>{e--,a[r]=1}))})},this.checkInterval)})}};