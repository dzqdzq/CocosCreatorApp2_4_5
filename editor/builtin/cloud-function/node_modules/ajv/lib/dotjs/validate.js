"use strict";module.exports=function(e,r,a){var t="",s=!0===e.schema.$async,o=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),l=e.self._getId(e.schema);if(e.opts.strictKeywords){var i=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(i){var n="unknown keyword: "+i;if("log"!==e.opts.strictKeywords)throw new Error(n);e.logger.warn(n)}}if(e.isTop&&(t+=" var validate = ",s&&(e.async=!0,t+="async "),t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",l&&(e.opts.sourceCode||e.opts.processCode)&&(t+=" /*# sourceURL="+l+" */ ")),"boolean"==typeof e.schema||!o&&!e.schema.$ref){var c=e.level,f=e.dataLevel,h=e.schema["false schema"],u=e.schemaPath+e.util.getProperty("false schema"),p=e.errSchemaPath+"/false schema",d=!e.opts.allErrors,m="data"+(f||""),v="valid"+c;if(!1===e.schema){e.isTop?d=!0:t+=" var "+v+" = false; ",(Y=Y||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(t+=" , message: 'boolean schema is false' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var y=t;t=Y.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?t+=s?" return data; ":" validate.errors = null; return true; ":t+=" var "+v+" = true; ";return e.isTop&&(t+=" }; return validate; "),t}if(e.isTop){var g=e.isTop;c=e.level=0,f=e.dataLevel=0,m="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],void 0!==e.schema.default&&e.opts.useDefaults&&e.opts.strictDefaults){var w="default is ignored in the schema root";if("log"!==e.opts.strictDefaults)throw new Error(w);e.logger.warn(w)}t+=" var vErrors = null; ",t+=" var errors = 0;     ",t+=" if (rootData === undefined) rootData = data; "}else{c=e.level,m="data"+((f=e.dataLevel)||"");if(l&&(e.baseId=e.resolve.url(e.baseId,l)),s&&!e.async)throw new Error("async schema in sync schema");t+=" var errs_"+c+" = errors;"}v="valid"+c,d=!e.opts.allErrors;var E,P="",b="",D=e.schema.type,S=Array.isArray(D);if(D&&e.opts.nullable&&!0===e.schema.nullable&&(S?-1==D.indexOf("null")&&(D=D.concat("null")):"null"!=D&&(D=[D,"null"],S=!0)),S&&1==D.length&&(D=D[0],S=!1),e.schema.$ref&&o){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(o=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(t+=" "+e.RULES.all.$comment.code(e,"$comment")),D){if(e.opts.coerceTypes)var R=e.util.coerceToTypes(e.opts.coerceTypes,D);var T=e.RULES.types[D];if(R||S||!0===T||T&&!Z(T)){u=e.schemaPath+".type",p=e.errSchemaPath+"/type",u=e.schemaPath+".type",p=e.errSchemaPath+"/type";var k=S?"checkDataTypes":"checkDataType";if(t+=" if ("+e.util[k](D,m,e.opts.strictNumbers,!0)+") { ",R){var $="dataType"+c,L="coerced"+c;t+=" var "+$+" = typeof "+m+"; var "+L+" = undefined; ","array"==e.opts.coerceTypes&&(t+=" if ("+$+" == 'object' && Array.isArray("+m+") && "+m+".length == 1) { "+m+" = "+m+"[0]; "+$+" = typeof "+m+"; if ("+e.util.checkDataType(e.schema.type,m,e.opts.strictNumbers)+") "+L+" = "+m+"; } "),t+=" if ("+L+" !== undefined) ; ";var j=R;if(j)for(var A,I=-1,U=j.length-1;I<U;)"string"==(A=j[I+=1])?t+=" else if ("+$+" == 'number' || "+$+" == 'boolean') "+L+" = '' + "+m+"; else if ("+m+" === null) "+L+" = ''; ":"number"==A||"integer"==A?(t+=" else if ("+$+" == 'boolean' || "+m+" === null || ("+$+" == 'string' && "+m+" && "+m+" == +"+m+" ","integer"==A&&(t+=" && !("+m+" % 1)"),t+=")) "+L+" = +"+m+"; "):"boolean"==A?t+=" else if ("+m+" === 'false' || "+m+" === 0 || "+m+" === null) "+L+" = false; else if ("+m+" === 'true' || "+m+" === 1) "+L+" = true; ":"null"==A?t+=" else if ("+m+" === '' || "+m+" === 0 || "+m+" === false) "+L+" = null; ":"array"==e.opts.coerceTypes&&"array"==A&&(t+=" else if ("+$+" == 'string' || "+$+" == 'number' || "+$+" == 'boolean' || "+m+" == null) "+L+" = ["+m+"]; ");t+=" else {   ",(Y=Y||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",t+=S?""+D.join(","):""+D,t+="' } ",!1!==e.opts.messages&&(t+=" , message: 'should be ",t+=S?""+D.join(","):""+D,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";y=t;t=Y.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } if ("+L+" !== undefined) {  ";var x=f?"data"+(f-1||""):"parentData",_=f?e.dataPathArr[f]:"parentDataProperty";t+=" "+m+" = "+L+"; ",f||(t+="if ("+x+" !== undefined)"),t+=" "+x+"["+_+"] = "+L+"; } "}else{(Y=Y||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",t+=S?""+D.join(","):""+D,t+="' } ",!1!==e.opts.messages&&(t+=" , message: 'should be ",t+=S?""+D.join(","):""+D,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";y=t;t=Y.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(e.schema.$ref&&!o)t+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",d&&(t+=" } if (errors === ",t+=g?"0":"errs_"+c,t+=") { ",b+="}");else{var N=e.RULES;if(N)for(var V=-1,O=N.length-1;V<O;)if(Z(T=N[V+=1])){if(T.type&&(t+=" if ("+e.util.checkDataType(T.type,m,e.opts.strictNumbers)+") { "),e.opts.useDefaults)if("object"==T.type&&e.schema.properties){h=e.schema.properties;var Q=Object.keys(h);if(Q)for(var C,J=-1,K=Q.length-1;J<K;){if(void 0!==(z=h[C=Q[J+=1]]).default){var H=m+e.util.getProperty(C);if(e.compositeRule){if(e.opts.strictDefaults){w="default is ignored for: "+H;if("log"!==e.opts.strictDefaults)throw new Error(w);e.logger.warn(w)}}else t+=" if ("+H+" === undefined ","empty"==e.opts.useDefaults&&(t+=" || "+H+" === null || "+H+" === '' "),t+=" ) "+H+" = ","shared"==e.opts.useDefaults?t+=" "+e.useDefault(z.default)+" ":t+=" "+JSON.stringify(z.default)+" ",t+="; "}}}else if("array"==T.type&&Array.isArray(e.schema.items)){var q=e.schema.items;if(q){I=-1;for(var z,B=q.length-1;I<B;)if(void 0!==(z=q[I+=1]).default){H=m+"["+I+"]";if(e.compositeRule){if(e.opts.strictDefaults){w="default is ignored for: "+H;if("log"!==e.opts.strictDefaults)throw new Error(w);e.logger.warn(w)}}else t+=" if ("+H+" === undefined ","empty"==e.opts.useDefaults&&(t+=" || "+H+" === null || "+H+" === '' "),t+=" ) "+H+" = ","shared"==e.opts.useDefaults?t+=" "+e.useDefault(z.default)+" ":t+=" "+JSON.stringify(z.default)+" ",t+="; "}}}var F=T.rules;if(F)for(var G,M=-1,W=F.length-1;M<W;)if(ee(G=F[M+=1])){var X=G.code(e,G.keyword,T.type);X&&(t+=" "+X+" ",d&&(P+="}"))}if(d&&(t+=" "+P+" ",P=""),T.type&&(t+=" } ",D&&D===T.type&&!R)){t+=" else { ";var Y;u=e.schemaPath+".type",p=e.errSchemaPath+"/type";(Y=Y||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",t+=S?""+D.join(","):""+D,t+="' } ",!1!==e.opts.messages&&(t+=" , message: 'should be ",t+=S?""+D.join(","):""+D,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";y=t;t=Y.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } "}d&&(t+=" if (errors === ",t+=g?"0":"errs_"+c,t+=") { ",b+="}")}}function Z(e){for(var r=e.rules,a=0;a<r.length;a++)if(ee(r[a]))return!0}function ee(r){return void 0!==e.schema[r.keyword]||r.implements&&function(r){for(var a=r.implements,t=0;t<a.length;t++)if(void 0!==e.schema[a[t]])return!0}(r)}return d&&(t+=" "+b+" "),g?(s?(t+=" if (errors === 0) return data;           ",t+=" else throw new ValidationError(vErrors); "):(t+=" validate.errors = vErrors; ",t+=" return errors === 0;       "),t+=" }; return validate;"):t+=" var "+v+" = errors === errs_"+c+";",t};